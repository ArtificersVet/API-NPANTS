create database dboNPANTS;
use dboNPANTS;

CREATE TABLE roles (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(255) NOT NULL,
  descripcion TEXT
);

create table usuarios(
id INT AUTO_INCREMENT PRIMARY KEY,
rol_id INT,
nombre VARCHAR(255) NOT NULL,
email VARCHAR(255) NOT NULL,
password VARCHAR(255) NOT NULL,
FOREIGN KEY (rol_id) REFERENCES roles(id)
);

insert into roles (nombre,descripcion) values ('Admin','Admin');

CREATE TABLE tipo_cliente (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    descripcion VARCHAR(255),
    nombre VARCHAR(255)
)

CREATE Table cliente (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    direccion VARCHAR(255),
    email VARCHAR(255),
    nombre VARCHAR(255),
    telefono VARCHAR(255),
    tipocliente_id BIGINT,
    Foreign Key (tipocliente_id) REFERENCES tipo_cliente(id)
)

CREATE Table tela(
    id BIGINT PRIMARY KEY,
    color VARCHAR(255),
    nombre VARCHAR(255),
    stock DOUBLE
)

CREATE Table talla(
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(255)
)

CREATE Table metodo_pago(
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(255)
)

CREATE Table estado_pedido(
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(255)
)

CREATE Table pedido(
        id BIGINT PRIMARY KEY AUTO_INCREMENT,
    fecha_pedido DATE,
    saldo DECIMAL(10,2),
    tipo_pago TINYINT,
    total DECIMAL(10,2),
    cliente_id BIGINT,
    estado_pedido_id BIGINT,
    Foreign Key (cliente_id) REFERENCES cliente(id),
    Foreign Key (estado_pedido_id) REFERENCES estado_pedido(id)
)

CREATE Table historial_pedido(
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    comentario VARCHAR(255),
    fecha DATETIME,
    estado_pedido_id BIGINT,
    pedido_id BIGINT,
    usuario_id2 INT,
    Foreign Key (estado_pedido_id) REFERENCES estado_pedido(id),
    Foreign Key (pedido_id) REFERENCES pedido(id),
    Foreign Key (usuario_id2) REFERENCES usuarios(id)
) 

CREATE Table tipo_prenda_vestir(
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(255)
)

CREATE Table pago(
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    fecha_pago DATE,
    monto DECIMAL(18,2),
    metodo_pago_id BIGINT,
    pedido_id BIGINT,
    Foreign Key (metodo_pago_id) REFERENCES metodo_pago(id),
    Foreign Key (pedido_id) REFERENCES pedido(id)
)

CREATE Table estilo(
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(255),
    tipo VARCHAR(255)
)

CREATE Table prenda_vestir(
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    descripcion VARCHAR(255),
    nombre VARCHAR(255),
    estilo_id BIGINT,
    tela_id BIGINT,
    tipoprendavestir_id BIGINT,
    Foreign Key (estilo_id) REFERENCES estilo(id),
    Foreign Key (tela_id) REFERENCES tela(id),
    Foreign Key (tipoprendavestir_id) REFERENCES tipo_prenda_vestir(id)
)

CREATE TABLE DetalleProducto (
    Id BIGINT AUTO_INCREMENT PRIMARY KEY,
    PedidoId BIGINT NOT NULL,
    PrendaVestirId BIGINT NOT NULL,
    TallaId BIGINT NOT NULL,
    Cantidad INT NOT NULL,
    Descripcion VARCHAR(255),
    Precio DECIMAL(10, 2) NOT NULL,
    TotalPieza BIGINT NOT NULL,
    ConsumoTela DECIMAL(10, 2),
    SubTotal DECIMAL(10, 2),
    
    -- Claves for√°neas
    CONSTRAINT FK_Pedido FOREIGN KEY (PedidoId) REFERENCES pedido(id) ON DELETE CASCADE,
    CONSTRAINT FK_PrendaVestir FOREIGN KEY (PrendaVestirId) REFERENCES prenda_vestir(id) ON DELETE CASCADE,
    CONSTRAINT FK_Talla FOREIGN KEY (TallaId) REFERENCES talla(id) ON DELETE CASCADE
);